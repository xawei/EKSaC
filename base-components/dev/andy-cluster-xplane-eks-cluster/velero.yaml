chart:
  name: velero
  repoURL: https://vmware-tanzu.github.io/helm-charts
  targetRevision: 10.0.10
  namespace: velero
  syncWave: "0"
  values:
    credentials:
      useSecret: false
    serviceAccount:
      server:
        create: true
        annotations:
          eks.amazonaws.com/role-arn: "arn:aws:iam::{{ .Values.cluster.awsAccountId }}:role/VeleroRole-{{ .Values.cluster.name }}"
    initContainers:
      - name: velero-plugin-for-aws
        image: velero/velero-plugin-for-aws:v1.5.0
        volumeMounts:
          - mountPath: /target
            name: plugins
    tolerations:
      - key: "karpenter.sh/nodepool"
        operator: "Equal"
        value: "infra"
        effect: "NoSchedule"
    # Disable CRD installation to avoid conflicts
    installCRDs: false
    # Or use upgrade CRDs hook
    upgradeCRDs: false
    # AWS provider configuration
    configuration:
      backupStorageLocation:
        - name: default
          provider: aws
          bucket: "velero-backup-{{ .Values.cluster.name }}"
          config:
            region: "{{ .Values.cluster.region }}"
      volumeSnapshotLocation:
        - name: default
          provider: aws
          config:
            region: "{{ .Values.cluster.region }}"
    # Current setup
    # schedules:
    #   daily-backup-all:
    #     disabled: true
    #     schedule: "0 17 * * *"
    #     useOwnerReferencesInBackup: false
    #     template:
    #       ttl: "168h0m0s"
    #       includedNamespaces:
    #         - "*"